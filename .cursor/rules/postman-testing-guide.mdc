# Postman Testing Guide - Ticket Master API

**Base URL**: `http://localhost:3000/api`

**Swagger Docs**: `http://localhost:3000/api` (auto-generated)

---

## üö® IMPORTANT: Testing Order

The order matters because entities have dependencies:

```
Venues ‚Üí Seats ‚Üí Events (auto-creates Tickets) ‚Üí Bookings
```

**Save IDs as you go!** You'll need them for subsequent requests.

---

## üìã Pre-requisites

1. Start the database:

   ```bash
   # Ensure PostgreSQL is running
   ```

2. Start the API:

   ```bash
   nx serve api
   ```

3. Verify it's running: Visit `http://localhost:3000/api` (Swagger UI)

---

## Step 1: Venues (Foundation) üèüÔ∏è

Venues have no dependencies - test these first.

### 1.1 Create Venue

```
POST http://localhost:3000/api/venues
```

**Headers:**

```
Content-Type: application/json
```

**Body:**

```json
{
  "name": "Madison Square Garden",
  "address": "4 Pennsylvania Plaza, New York, NY 10001"
}
```

**Expected Response:** `201 Created`

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Madison Square Garden",
  "address": "4 Pennsylvania Plaza, New York, NY 10001",
  "createdAt": "2024-12-27T10:00:00.000Z",
  "updatedAt": "2024-12-27T10:00:00.000Z"
}
```

‚ö†Ô∏è **SAVE THE `id`** - You'll need it for seats and events!

---

### 1.2 Create Second Venue (for testing)

```
POST http://localhost:3000/api/venues
```

**Body:**

```json
{
  "name": "O2 Arena",
  "address": "Peninsula Square, London SE10 0DX"
}
```

---

### 1.3 Get All Venues

```
GET http://localhost:3000/api/venues
```

**Expected Response:** `200 OK` - Array of all venues

---

### 1.4 Get Venue by ID

```
GET http://localhost:3000/api/venues/:id
```

**Example:**

```
GET http://localhost:3000/api/venues/550e8400-e29b-41d4-a716-446655440000
```

**Expected Response:** `200 OK` - Single venue object

---

### 1.5 Update Venue

```
PATCH http://localhost:3000/api/venues/:id
```

**Example:**

```
PATCH http://localhost:3000/api/venues/550e8400-e29b-41d4-a716-446655440000
```

**Body (partial update):**

```json
{
  "name": "MSG Arena"
}
```

**Expected Response:** `200 OK` - Updated venue

---

### 1.6 Delete Venue (test last - use the second venue)

```
DELETE http://localhost:3000/api/venues/:id
```

**Expected Response:** `204 No Content`

---

### 1.7 Test Validation Errors

**Missing required field:**

```
POST http://localhost:3000/api/venues
```

```json
{
  "name": "Test Venue"
}
```

**Expected:** `400 Bad Request`

**Invalid UUID:**

```
GET http://localhost:3000/api/venues/not-a-uuid
```

**Expected:** `400 Bad Request`

**Not found:**

```
GET http://localhost:3000/api/venues/00000000-0000-0000-0000-000000000000
```

**Expected:** `404 Not Found`

---

## Step 2: Seats (Depends on Venues) üí∫

You need a venue ID before creating seats.

### 2.1 Create Single Seat

```
POST http://localhost:3000/api/seats
```

**Headers:**

```
Content-Type: application/json
```

**Body:**

```json
{
  "section": "A",
  "row": "1",
  "number": 1,
  "venueId": "YOUR_VENUE_ID_HERE"
}
```

**Expected Response:** `201 Created`

```json
[
  {
    "id": "...",
    "section": "A",
    "row": "1",
    "number": 1,
    "venueId": "...",
    "createdAt": "...",
    "updatedAt": "..."
  }
]
```

‚ö†Ô∏è **SAVE THE `id`** - You'll need it later!

---

### 2.2 Create Multiple Seats (Bulk)

```
POST http://localhost:3000/api/seats
```

**Body (array):**

```json
[
  {
    "section": "A",
    "row": "1",
    "number": 2,
    "venueId": "YOUR_VENUE_ID_HERE"
  },
  {
    "section": "A",
    "row": "1",
    "number": 3,
    "venueId": "YOUR_VENUE_ID_HERE"
  },
  {
    "section": "A",
    "row": "2",
    "number": 1,
    "venueId": "YOUR_VENUE_ID_HERE"
  },
  {
    "section": "B",
    "row": "1",
    "number": 1,
    "venueId": "YOUR_VENUE_ID_HERE"
  },
  {
    "section": "B",
    "row": "1",
    "number": 2,
    "venueId": "YOUR_VENUE_ID_HERE"
  }
]
```

**Expected Response:** `201 Created` - Array of created seats

---

### 2.3 Get All Seats (Paginated)

```
GET http://localhost:3000/api/seats
```

**With pagination:**

```
GET http://localhost:3000/api/seats?page=1&limit=10
```

**Expected Response:** `200 OK`

```json
{
  "data": [...],
  "meta": {
    "page": 1,
    "limit": 10,
    "total": 6,
    "totalPages": 1
  }
}
```

---

### 2.4 Get Seats by Venue

```
GET http://localhost:3000/api/seats/venue/:venueId
```

**Example:**

```
GET http://localhost:3000/api/seats/venue/YOUR_VENUE_ID_HERE
```

**Expected Response:** `200 OK` - Array of seats for that venue

---

### 2.5 Get Seat by ID

```
GET http://localhost:3000/api/seats/:id
```

**Expected Response:** `200 OK` - Single seat object

---

### 2.6 Update Seat

```
PATCH http://localhost:3000/api/seats/:id
```

**Body:**

```json
{
  "section": "VIP"
}
```

**Expected Response:** `200 OK` - Updated seat

---

### 2.7 Delete Seat

```
DELETE http://localhost:3000/api/seats/:id
```

**Expected Response:** `204 No Content`

---

### 2.8 Test Validation Errors

**Invalid venue ID:**

```
POST http://localhost:3000/api/seats
```

```json
{
  "section": "A",
  "row": "1",
  "number": 1,
  "venueId": "not-a-uuid"
}
```

**Expected:** `400 Bad Request`

**Non-existent venue:**

```
POST http://localhost:3000/api/seats
```

```json
{
  "section": "A",
  "row": "1",
  "number": 1,
  "venueId": "00000000-0000-0000-0000-000000000000"
}
```

**Expected:** `404 Not Found`

**Duplicate seat (same venue + section + row + number):**
Try creating the same seat twice.
**Expected:** `409 Conflict`

---

## Step 3: Events (Depends on Venues + Seats) üé´

Events need:

- A venue ID
- The venue must have seats (tickets are auto-generated for each seat)

### 3.1 Create Event

```
POST http://localhost:3000/api/events
```

**Headers:**

```
Content-Type: application/json
```

**Body:**

```json
{
  "name": "Rock Concert 2025",
  "date": "2025-06-15T20:00:00Z",
  "basePrice": 99.99,
  "venueId": "YOUR_VENUE_ID_HERE"
}
```

**Expected Response:** `201 Created`

```json
{
  "id": "...",
  "name": "Rock Concert 2025",
  "date": "2025-06-15T20:00:00.000Z",
  "basePrice": 99.99,
  "status": "SCHEDULED",
  "venueId": "...",
  "createdAt": "...",
  "updatedAt": "..."
}
```

‚ö†Ô∏è **SAVE THE `id`** - You'll need it for tickets!

üéâ **Tickets are auto-created!** One ticket per seat at the venue.

---

### 3.2 Create Another Event (same venue)

```
POST http://localhost:3000/api/events
```

**Body:**

```json
{
  "name": "Jazz Night 2025",
  "date": "2025-07-20T19:30:00Z",
  "basePrice": 75.0,
  "venueId": "YOUR_VENUE_ID_HERE"
}
```

---

### 3.3 Get All Events (Paginated)

```
GET http://localhost:3000/api/events
```

**With pagination:**

```
GET http://localhost:3000/api/events?page=1&limit=10
```

**Expected Response:** `200 OK`

```json
{
  "data": [...],
  "meta": {
    "page": 1,
    "limit": 10,
    "total": 2,
    "totalPages": 1
  }
}
```

---

### 3.4 Get Event by ID

```
GET http://localhost:3000/api/events/:id
```

**Expected Response:** `200 OK` - Single event object

---

### 3.5 Update Event

```
PATCH http://localhost:3000/api/events/:id
```

**Body:**

```json
{
  "basePrice": 129.99
}
```

**Expected Response:** `200 OK` - Updated event

---

### 3.6 Delete Event

```
DELETE http://localhost:3000/api/events/:id
```

**Expected Response:** `204 No Content`

‚ö†Ô∏è **Note:** This will also delete all tickets for that event!

---

### 3.7 Test Validation Errors

**Invalid date format:**

```
POST http://localhost:3000/api/events
```

```json
{
  "name": "Test Event",
  "date": "not-a-date",
  "basePrice": 50,
  "venueId": "YOUR_VENUE_ID_HERE"
}
```

**Expected:** `400 Bad Request`

**Negative price:**

```
POST http://localhost:3000/api/events
```

```json
{
  "name": "Test Event",
  "date": "2025-06-15T20:00:00Z",
  "basePrice": -10,
  "venueId": "YOUR_VENUE_ID_HERE"
}
```

**Expected:** `400 Bad Request`

---

## Step 4: Tickets (Read-Only) üéüÔ∏è

Tickets are auto-created when events are created. They are managed through Events and Bookings.

### 4.1 Get All Tickets for Event

```
GET http://localhost:3000/api/tickets/event/:eventId
```

**Example:**

```
GET http://localhost:3000/api/tickets/event/YOUR_EVENT_ID_HERE
```

**Expected Response:** `200 OK`

```json
[
  {
    "id": "...",
    "price": 99.99,
    "status": "AVAILABLE",
    "heldAt": null,
    "eventId": "...",
    "seatId": "...",
    "bookingId": null,
    "createdAt": "...",
    "updatedAt": "..."
  },
  ...
]
```

‚ö†Ô∏è **SAVE TICKET `id`s** - You'll need them for bookings!

---

### 4.2 Get Available Ticket Count

```
GET http://localhost:3000/api/tickets/event/:eventId/available
```

**Example:**

```
GET http://localhost:3000/api/tickets/event/YOUR_EVENT_ID_HERE/available
```

**Expected Response:** `200 OK`

```json
{
  "available": 5,
  "total": 5
}
```

---

## Step 5: Bookings (Depends on Tickets) üìù

Bookings are the final piece - they require ticket IDs from available tickets.

### 5.1 Create Booking

```
POST http://localhost:3000/api/bookings
```

**Headers:**

```
Content-Type: application/json
```

**Body:**

```json
{
  "userId": "550e8400-e29b-41d4-a716-446655440001",
  "ticketIds": ["TICKET_ID_1", "TICKET_ID_2"]
}
```

**Expected Response:** `201 Created`

```json
{
  "id": "...",
  "userId": "550e8400-e29b-41d4-a716-446655440001",
  "totalPrice": 199.98,
  "status": "CONFIRMED",
  "tickets": [...],
  "createdAt": "...",
  "updatedAt": "..."
}
```

‚ö†Ô∏è **SAVE THE `id`** - You'll need it to view or cancel!

---

### 5.2 Get Booking by ID

```
GET http://localhost:3000/api/bookings/:id
```

**Example:**

```
GET http://localhost:3000/api/bookings/YOUR_BOOKING_ID_HERE
```

**Expected Response:** `200 OK` - Booking with tickets loaded

---

### 5.3 Cancel Booking

```
POST http://localhost:3000/api/bookings/:id/cancel
```

**Example:**

```
POST http://localhost:3000/api/bookings/YOUR_BOOKING_ID_HERE/cancel
```

**Expected Response:** `200 OK`

‚úÖ **Verify:** Get tickets for that event again - they should be `AVAILABLE`

---

### 5.4 Test Business Logic

**Try booking already sold tickets:**

1. Create a booking with ticket IDs
2. Try creating another booking with the same ticket IDs

**Expected:** `409 Conflict` - "One or more tickets are no longer available"

**Try cancelling twice:**

1. Cancel a booking
2. Try cancelling the same booking again

**Expected:** `409 Conflict` - "Booking already cancelled"

**Empty ticket array:**

```
POST http://localhost:3000/api/bookings
```

```json
{
  "userId": "550e8400-e29b-41d4-a716-446655440001",
  "ticketIds": []
}
```

**Expected:** `400 Bad Request`

**Non-existent ticket:**

```
POST http://localhost:3000/api/bookings
```

```json
{
  "userId": "550e8400-e29b-41d4-a716-446655440001",
  "ticketIds": ["00000000-0000-0000-0000-000000000000"]
}
```

**Expected:** `404 Not Found`

---

## üß™ Complete Happy Path Test Sequence

Run these in order for a complete integration test:

| #   | Method | Endpoint                            | Purpose                              |
| --- | ------ | ----------------------------------- | ------------------------------------ |
| 1   | POST   | `/venues`                           | Create venue "Madison Square Garden" |
| 2   | GET    | `/venues`                           | Verify venue created                 |
| 3   | POST   | `/seats`                            | Create 5 seats (bulk)                |
| 4   | GET    | `/seats/venue/:venueId`             | Verify seats created                 |
| 5   | POST   | `/events`                           | Create "Rock Concert" event          |
| 6   | GET    | `/events`                           | Verify event created                 |
| 7   | GET    | `/tickets/event/:eventId`           | Get auto-generated tickets           |
| 8   | GET    | `/tickets/event/:eventId/available` | Verify 5/5 available                 |
| 9   | POST   | `/bookings`                         | Book 2 tickets                       |
| 10  | GET    | `/bookings/:id`                     | Verify booking created               |
| 11  | GET    | `/tickets/event/:eventId/available` | Verify 3/5 available                 |
| 12  | POST   | `/bookings/:id/cancel`              | Cancel the booking                   |
| 13  | GET    | `/tickets/event/:eventId/available` | Verify 5/5 available again           |

---

## üî¥ Error Response Format

All errors follow this format:

```json
{
  "statusCode": 400,
  "message": "Error description",
  "error": "Bad Request",
  "timestamp": "2024-12-27T10:00:00.000Z",
  "path": "/api/venues"
}
```

---

## üì¶ Postman Collection Tips

1. **Create Environment Variables:**

   - `baseUrl`: `http://localhost:3000/api`
   - `venueId`: (save after creating)
   - `eventId`: (save after creating)
   - `ticketId1`, `ticketId2`: (save from ticket list)
   - `bookingId`: (save after creating)

2. **Use Tests Tab to Save IDs:**

   ```javascript
   // In "Tests" tab of Create Venue request
   var jsonData = pm.response.json();
   pm.environment.set('venueId', jsonData.id);
   ```

3. **Use Variables in URLs:**
   ```
   {{baseUrl}}/venues/{{venueId}}
   ```

---

## ‚úÖ Checklist

- [ ] Venues: Create, Get All, Get One, Update, Delete
- [ ] Venues: Test validation errors
- [ ] Seats: Create single, Create bulk
- [ ] Seats: Get all (paginated), Get by venue, Get one, Update, Delete
- [ ] Seats: Test duplicate seat error
- [ ] Events: Create, Get all (paginated), Get one, Update, Delete
- [ ] Events: Verify tickets auto-created
- [ ] Tickets: Get by event, Get availability count
- [ ] Bookings: Create, Get by ID, Cancel
- [ ] Bookings: Test conflict errors (already sold, already cancelled)
- [ ] Complete happy path sequence
